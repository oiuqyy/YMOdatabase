import requests
from selenium import webdriver
from bs4 import BeautifulSoup
from selenium.webdriver.common.by import By
url = 'https://music.163.com/#/playlist?id=2439378415'
headers = {
    'Referer': 'http://music.163.com/',
    'Host': 'music.163.com',
    'cookie': 'ntes_kaola_ad=1; WEVNSM=1.0.0; WM_TID=vkgWUMO4XxpEUEVEAELEkMx1o95BSFZZ; NTES_YD_SESS=gjOttaJ84Dg5QIvxJnZN71e236DfHe0kNiB3JMsAJlfLj0mKjiCG5_gwApEZkSuKlTGhWqFOp8IJs2MENDtC_wL3T96zIdgAyZQsfybwGfOI.MPxTFNh9WwNbk2ERutCxHzVqfV0QR4BLQWSykK8AlXZEP7hoLu.Bf.jtRZrpDk8ZA8wbOSHyOeJs7zMWfnmihHkJIm8EZ6A5uBo.u8749W3oX.2n93irKNeH5_ub1bu8; P_INFO=13124898918|1686393029|1|music|00&99|null&null&null#shh&null#10#0|&0||13124898918; S_INFO=1686393029|0|0&60##|13124898918; NTES_P_UTID=b6F4gvEzlnz90Vqfwzgb1m9siVvG4Ruq|1686393007; MUSIC_U=0066575F5D8D64D4163FA298A322F183FECA5500B36DC5A85DDA3F69F90D0DE97918097964FD6B9D2003502BB2A1575AAC49462764091D1CBBAACF4332BD03B6D3AFE5C9F22A2CF8FC3E18FF044749703CA01F1D43206DF497D295C68E6E2EFCDD1090B8BC66DF7E3D1005BE0E6E77739F6BAA8508C7C5347F059C343C61471148484B0808B7DDCA487F5EFE1B71CDE7525FB9CB42D0CDDCDF50051FE94281B781BDEB235A11F0D7CDDB6288BFBE5F9366AB8947933DAF3C192ADDC6357D169B40BDD16CB74838A705D000BDC713A10B1EB4A6E4CAA3E6CA94260FF5D1818351E11757356C4CBCA050484DC3D249211902FD97F01D24D6D707784B3A908C6D9F83AB6DAAA9B84FAF36BA5F458AC490FB975E929637C2E123C2B7B4EC5120DF9753E1A7D20D5107EF0275D81EDE34717D30A92A95CD6FCB4430E7ECA16AD934CB65A601DEC8FD4375A19CDEC14FAEF7E2A666C2AC23B5BA6392D4632BBCB40C6438; __csrf=1d312326e041a94dec59f654e781e7ce; __remember_me=true; YD00000558929251%3AWM_NI=NN8k7AeTe8s8R61X4udNgetu%2F1b4JMR9m63gxJe1Mayt29tRjaWxQpioPl7cs%2BYy0oiTfGnYJVlrodmAV2axK6ql8TLvzhp4BXQ7up2rUxFmZyavvh5tvUEYgfNCkGPhV08%3D; YD00000558929251%3AWM_NIKE=9ca17ae2e6ffcda170e2e6ee8af24bfcb889b0f65ab4ac8eb2d85f969b8bb1c86d8bf0ffdab74086879794bc2af0fea7c3b92a8e92f88cb64ba78cabd9f23492eaffb9b77fa892a986f77fedefaed5c94792e7a3d7b26dbc96abd2d06bbbacfedaf75aaabf9999d47cabb1a08db669b1f5979ab365ab8caaa8ed538a8aa493ee70af9f9ad3e47489eabf8dbb6090aab689f34082889fd8f87cf2ae9b99c5679aa7af97f564f7acbab6c853a5ba82a4ea4d94b89ad1bb37e2a3; YD00000558929251%3AWM_TID=pKZGb5NfXJZEAAQAUAPRhNw1ootUYdpo; WM_NI=aYtBbZ8t5JhsEulHGD4QgVJd6wPVxuiAwnyguFCOF31CzDlvAlYIXz6vrHzGiV%2FZec9ksmsV7HwN8qxZC4TeuSC5jzIVIQzgGpVivqPgYCanKNCoKvCqK2hWRr0aFNi4OUY%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6eedaaa6b88b9bca6fb7fa39a8ab3c44b969b9a87d161a1b8a9d5bb3f928d979ace2af0fea7c3b92aa387bca3e152fcacfbabeb7987aba4a9c650f88fa9b7c970f6a9a0b7fb7fab9fb98ffc6db79a8db0c539f39db6a5ef7e83b497aadb72f6aabea9f94dab8ae1bbe869fbb5bd8ef25ef598b9afbb7bbc868dd5d76fb78d8dd6e9728b8a87b2f96d85b09a8af57b94b997a4e46689928d90ca7e81af85d3eb5d92ae0082c546abec81b6dc37e2a3; gdxidpyhxdE=o%2B7n0k8rQ%2B5%5CfB6ICaauCHo%2FVU0lVDPQETrKWdm%2FAXK56bhoQg684pVa2LQobcnk9O%5Cn4fOrm%2BqE%2FnAoVbgkUM45olT%2Bod3Ib6Nd0aciQOoLpe7Zo1oajvCjO32tflOVe%2B4g1OKbjNw%2BSZf0Cg%5C99dU%2B4hiQaAG8iNxR3hZSE%5CIVjC2j%3A1686393896906; sDeviceId=YD-pQlIN4WhyfRBBlUQEALEPGhFx1dOVZpK; ntes_utid=tid._.wJeJd3rtgclAUlBAFRaBlMgg84yv8adh._.0; __snaker__id=ef0yQAMFeczsUV5s; WNMCID=xacznr.1686392992704.01.0; _ntes_nnid=e074b1118491c5e7a547d365fd438f0f,1686392985178; _ntes_nuid=e074b1118491c5e7a547d365fd438f0f; JSESSIONID-WYYY=A4MhKOnM%5CUX6NykTXYcvUmPNnoOKGse%2Fvo0ef%2FGC2rHUKl199rgQA%2BzU4XphYPK4XyCN3bCMWCrhIop%2Bvx5AerIG4%2Bje6777eaJm%5CO44zcQXc%2F6lIHO1%2BNf%5Ci6wTXlaGeyDGGwAPyqbuMGN%2B7anjT5b42b%2FOrEF8lE8BfHKYuCeUiMgq%3A1686394785079; _iuqxldmzr_=32; NMTID=00OmAJ5LXCp0Rb12UDltrJZytKjn8kAAAGIpNrT3Q',
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',}

driver = webdriver.Safari()
driver.add_cookie({'name':'SnowChester', 'value':'ntes_kaola_ad=1; WEVNSM=1.0.0; WM_TID=vkgWUMO4XxpEUEVEAELEkMx1o95BSFZZ; NTES_YD_SESS=gjOttaJ84Dg5QIvxJnZN71e236DfHe0kNiB3JMsAJlfLj0mKjiCG5_gwApEZkSuKlTGhWqFOp8IJs2MENDtC_wL3T96zIdgAyZQsfybwGfOI.MPxTFNh9WwNbk2ERutCxHzVqfV0QR4BLQWSykK8AlXZEP7hoLu.Bf.jtRZrpDk8ZA8wbOSHyOeJs7zMWfnmihHkJIm8EZ6A5uBo.u8749W3oX.2n93irKNeH5_ub1bu8; P_INFO=13124898918|1686393029|1|music|00&99|null&null&null#shh&null#10#0|&0||13124898918; S_INFO=1686393029|0|0&60##|13124898918; NTES_P_UTID=b6F4gvEzlnz90Vqfwzgb1m9siVvG4Ruq|1686393007; MUSIC_U=0066575F5D8D64D4163FA298A322F183FECA5500B36DC5A85DDA3F69F90D0DE97918097964FD6B9D2003502BB2A1575AAC49462764091D1CBBAACF4332BD03B6D3AFE5C9F22A2CF8FC3E18FF044749703CA01F1D43206DF497D295C68E6E2EFCDD1090B8BC66DF7E3D1005BE0E6E77739F6BAA8508C7C5347F059C343C61471148484B0808B7DDCA487F5EFE1B71CDE7525FB9CB42D0CDDCDF50051FE94281B781BDEB235A11F0D7CDDB6288BFBE5F9366AB8947933DAF3C192ADDC6357D169B40BDD16CB74838A705D000BDC713A10B1EB4A6E4CAA3E6CA94260FF5D1818351E11757356C4CBCA050484DC3D249211902FD97F01D24D6D707784B3A908C6D9F83AB6DAAA9B84FAF36BA5F458AC490FB975E929637C2E123C2B7B4EC5120DF9753E1A7D20D5107EF0275D81EDE34717D30A92A95CD6FCB4430E7ECA16AD934CB65A601DEC8FD4375A19CDEC14FAEF7E2A666C2AC23B5BA6392D4632BBCB40C6438; __csrf=1d312326e041a94dec59f654e781e7ce; __remember_me=true; YD00000558929251%3AWM_NI=NN8k7AeTe8s8R61X4udNgetu%2F1b4JMR9m63gxJe1Mayt29tRjaWxQpioPl7cs%2BYy0oiTfGnYJVlrodmAV2axK6ql8TLvzhp4BXQ7up2rUxFmZyavvh5tvUEYgfNCkGPhV08%3D; YD00000558929251%3AWM_NIKE=9ca17ae2e6ffcda170e2e6ee8af24bfcb889b0f65ab4ac8eb2d85f969b8bb1c86d8bf0ffdab74086879794bc2af0fea7c3b92a8e92f88cb64ba78cabd9f23492eaffb9b77fa892a986f77fedefaed5c94792e7a3d7b26dbc96abd2d06bbbacfedaf75aaabf9999d47cabb1a08db669b1f5979ab365ab8caaa8ed538a8aa493ee70af9f9ad3e47489eabf8dbb6090aab689f34082889fd8f87cf2ae9b99c5679aa7af97f564f7acbab6c853a5ba82a4ea4d94b89ad1bb37e2a3; YD00000558929251%3AWM_TID=pKZGb5NfXJZEAAQAUAPRhNw1ootUYdpo; WM_NI=aYtBbZ8t5JhsEulHGD4QgVJd6wPVxuiAwnyguFCOF31CzDlvAlYIXz6vrHzGiV%2FZec9ksmsV7HwN8qxZC4TeuSC5jzIVIQzgGpVivqPgYCanKNCoKvCqK2hWRr0aFNi4OUY%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6eedaaa6b88b9bca6fb7fa39a8ab3c44b969b9a87d161a1b8a9d5bb3f928d979ace2af0fea7c3b92aa387bca3e152fcacfbabeb7987aba4a9c650f88fa9b7c970f6a9a0b7fb7fab9fb98ffc6db79a8db0c539f39db6a5ef7e83b497aadb72f6aabea9f94dab8ae1bbe869fbb5bd8ef25ef598b9afbb7bbc868dd5d76fb78d8dd6e9728b8a87b2f96d85b09a8af57b94b997a4e46689928d90ca7e81af85d3eb5d92ae0082c546abec81b6dc37e2a3; gdxidpyhxdE=o%2B7n0k8rQ%2B5%5CfB6ICaauCHo%2FVU0lVDPQETrKWdm%2FAXK56bhoQg684pVa2LQobcnk9O%5Cn4fOrm%2BqE%2FnAoVbgkUM45olT%2Bod3Ib6Nd0aciQOoLpe7Zo1oajvCjO32tflOVe%2B4g1OKbjNw%2BSZf0Cg%5C99dU%2B4hiQaAG8iNxR3hZSE%5CIVjC2j%3A1686393896906; sDeviceId=YD-pQlIN4WhyfRBBlUQEALEPGhFx1dOVZpK; ntes_utid=tid._.wJeJd3rtgclAUlBAFRaBlMgg84yv8adh._.0; __snaker__id=ef0yQAMFeczsUV5s; WNMCID=xacznr.1686392992704.01.0; _ntes_nnid=e074b1118491c5e7a547d365fd438f0f,1686392985178; _ntes_nuid=e074b1118491c5e7a547d365fd438f0f; JSESSIONID-WYYY=A4MhKOnM%5CUX6NykTXYcvUmPNnoOKGse%2Fvo0ef%2FGC2rHUKl199rgQA%2BzU4XphYPK4XyCN3bCMWCrhIop%2Bvx5AerIG4%2Bje6777eaJm%5CO44zcQXc%2F6lIHO1%2BNf%5Ci6wTXlaGeyDGGwAPyqbuMGN%2B7anjT5b42b%2FOrEF8lE8BfHKYuCeUiMgq%3A1686394785079; _iuqxldmzr_=32; NMTID=00OmAJ5LXCp0Rb12UDltrJZytKjn8kAAAGIpNrT3Q'})
driver.get(url)
iframe = driver.find_element(By.XPATH, "//iframe") # 可以修改xpath, 这里默认获取到第一个iframe节点
driver.switch_to.frame(iframe) # 切换到iframe中
#print(driver.page_source) # 可以查看到iframe中的网页源代码
print('good')

driver.implicitly_wait(20)

a = driver.find_elements(By.XPATH, "//span[@class='txt']/a")
hrefs = [x.get_attribute('href') for x in a]
print(hrefs)

print('\nhrefs have been found!')
names = [i.get_attribute('title') for i in driver.find_elements(By.XPATH, "//span[@class='txt']/a/b")]
i = -1
driver.close()
for href in hrefs:
    i+=1
    index = href.split('=')[1]
    songurl = 'https://music.163.com/#/song?id={}'.format(index)
    url = 'https://music.163.com/song/media/outer/url?id={}.mp3'.format(index)
    myfile = requests.get(url)
    open((str(i+1)+'_'+names[i]+'.mp3'), 'wb').write(myfile.content)
    #同时下载歌曲封面，未实现
    #driver2 = webdriver.Safari()
    #driver2.add_cookie({'name':'SnowChester', 'value':'ntes_kaola_ad=1; WEVNSM=1.0.0; WM_TID=vkgWUMO4XxpEUEVEAELEkMx1o95BSFZZ; NTES_YD_SESS=gjOttaJ84Dg5QIvxJnZN71e236DfHe0kNiB3JMsAJlfLj0mKjiCG5_gwApEZkSuKlTGhWqFOp8IJs2MENDtC_wL3T96zIdgAyZQsfybwGfOI.MPxTFNh9WwNbk2ERutCxHzVqfV0QR4BLQWSykK8AlXZEP7hoLu.Bf.jtRZrpDk8ZA8wbOSHyOeJs7zMWfnmihHkJIm8EZ6A5uBo.u8749W3oX.2n93irKNeH5_ub1bu8; P_INFO=13124898918|1686393029|1|music|00&99|null&null&null#shh&null#10#0|&0||13124898918; S_INFO=1686393029|0|0&60##|13124898918; NTES_P_UTID=b6F4gvEzlnz90Vqfwzgb1m9siVvG4Ruq|1686393007; MUSIC_U=0066575F5D8D64D4163FA298A322F183FECA5500B36DC5A85DDA3F69F90D0DE97918097964FD6B9D2003502BB2A1575AAC49462764091D1CBBAACF4332BD03B6D3AFE5C9F22A2CF8FC3E18FF044749703CA01F1D43206DF497D295C68E6E2EFCDD1090B8BC66DF7E3D1005BE0E6E77739F6BAA8508C7C5347F059C343C61471148484B0808B7DDCA487F5EFE1B71CDE7525FB9CB42D0CDDCDF50051FE94281B781BDEB235A11F0D7CDDB6288BFBE5F9366AB8947933DAF3C192ADDC6357D169B40BDD16CB74838A705D000BDC713A10B1EB4A6E4CAA3E6CA94260FF5D1818351E11757356C4CBCA050484DC3D249211902FD97F01D24D6D707784B3A908C6D9F83AB6DAAA9B84FAF36BA5F458AC490FB975E929637C2E123C2B7B4EC5120DF9753E1A7D20D5107EF0275D81EDE34717D30A92A95CD6FCB4430E7ECA16AD934CB65A601DEC8FD4375A19CDEC14FAEF7E2A666C2AC23B5BA6392D4632BBCB40C6438; __csrf=1d312326e041a94dec59f654e781e7ce; __remember_me=true; YD00000558929251%3AWM_NI=NN8k7AeTe8s8R61X4udNgetu%2F1b4JMR9m63gxJe1Mayt29tRjaWxQpioPl7cs%2BYy0oiTfGnYJVlrodmAV2axK6ql8TLvzhp4BXQ7up2rUxFmZyavvh5tvUEYgfNCkGPhV08%3D; YD00000558929251%3AWM_NIKE=9ca17ae2e6ffcda170e2e6ee8af24bfcb889b0f65ab4ac8eb2d85f969b8bb1c86d8bf0ffdab74086879794bc2af0fea7c3b92a8e92f88cb64ba78cabd9f23492eaffb9b77fa892a986f77fedefaed5c94792e7a3d7b26dbc96abd2d06bbbacfedaf75aaabf9999d47cabb1a08db669b1f5979ab365ab8caaa8ed538a8aa493ee70af9f9ad3e47489eabf8dbb6090aab689f34082889fd8f87cf2ae9b99c5679aa7af97f564f7acbab6c853a5ba82a4ea4d94b89ad1bb37e2a3; YD00000558929251%3AWM_TID=pKZGb5NfXJZEAAQAUAPRhNw1ootUYdpo; WM_NI=aYtBbZ8t5JhsEulHGD4QgVJd6wPVxuiAwnyguFCOF31CzDlvAlYIXz6vrHzGiV%2FZec9ksmsV7HwN8qxZC4TeuSC5jzIVIQzgGpVivqPgYCanKNCoKvCqK2hWRr0aFNi4OUY%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6eedaaa6b88b9bca6fb7fa39a8ab3c44b969b9a87d161a1b8a9d5bb3f928d979ace2af0fea7c3b92aa387bca3e152fcacfbabeb7987aba4a9c650f88fa9b7c970f6a9a0b7fb7fab9fb98ffc6db79a8db0c539f39db6a5ef7e83b497aadb72f6aabea9f94dab8ae1bbe869fbb5bd8ef25ef598b9afbb7bbc868dd5d76fb78d8dd6e9728b8a87b2f96d85b09a8af57b94b997a4e46689928d90ca7e81af85d3eb5d92ae0082c546abec81b6dc37e2a3; gdxidpyhxdE=o%2B7n0k8rQ%2B5%5CfB6ICaauCHo%2FVU0lVDPQETrKWdm%2FAXK56bhoQg684pVa2LQobcnk9O%5Cn4fOrm%2BqE%2FnAoVbgkUM45olT%2Bod3Ib6Nd0aciQOoLpe7Zo1oajvCjO32tflOVe%2B4g1OKbjNw%2BSZf0Cg%5C99dU%2B4hiQaAG8iNxR3hZSE%5CIVjC2j%3A1686393896906; sDeviceId=YD-pQlIN4WhyfRBBlUQEALEPGhFx1dOVZpK; ntes_utid=tid._.wJeJd3rtgclAUlBAFRaBlMgg84yv8adh._.0; __snaker__id=ef0yQAMFeczsUV5s; WNMCID=xacznr.1686392992704.01.0; _ntes_nnid=e074b1118491c5e7a547d365fd438f0f,1686392985178; _ntes_nuid=e074b1118491c5e7a547d365fd438f0f; JSESSIONID-WYYY=A4MhKOnM%5CUX6NykTXYcvUmPNnoOKGse%2Fvo0ef%2FGC2rHUKl199rgQA%2BzU4XphYPK4XyCN3bCMWCrhIop%2Bvx5AerIG4%2Bje6777eaJm%5CO44zcQXc%2F6lIHO1%2BNf%5Ci6wTXlaGeyDGGwAPyqbuMGN%2B7anjT5b42b%2FOrEF8lE8BfHKYuCeUiMgq%3A1686394785079; _iuqxldmzr_=32; NMTID=00OmAJ5LXCp0Rb12UDltrJZytKjn8kAAAGIpNrT3Q'})
    #driver2.get(songurl)
    #imgclass = driver2.find_elements(By.XPATH, "//div[@class='u-cover u-cover-6 f-fl']/img")
    #imgsrc = imgclass[0].get_attribute('src')
    #myfile2 = requests.get(imgsrc)
    #open((str(i+1)+'_'+names[i]+'.jpg'), 'wb').write(myfile.content)
    #driver2.close()
print('--end--')
